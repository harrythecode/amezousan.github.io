<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>QRコードリーダー</title>
    </head>
    <body>
        <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
        <script>
            window.addEventListener('load', async () => {
                const defaultLiffId = "1657181939-KgqvllNZ";
                const liffClient = await setLiffClient(defaultLiffId)
                const scanResult = await getScanCode(liffClient)
                
                liffClient(() => {
                    if(scanResult) {
                        liff.sendMessages([{
                                'type': 'text',
                                'text': 'スキャンしたコード: ' + scanResult
                            }]).then(() => {
                                window.alert('Message Sent')
                            }).catch((err) => {
                                window.alert('Error sending message: ' + err);
                            });
                    }
                    liff.closeWindow();
                });
            });
            
            // ***
            // * Functions
            const setLiffClient = (defaultLiffId) => {
              return (func) => { liff.init({ liffId: defaultLiffId }).then(func) }
            }

            const getScanCode = async (liffClient) => {
                liffClient(() => {
                    liff.scanCodeV2().then(result => {
                        return result.value;
                    }).catch(err => {
                        window.alert('scanCode failed!\n' + err);
                    });
                });
            }
            // ***
        </script>
    </body>
</html>

